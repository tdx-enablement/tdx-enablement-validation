# Build TDX Guest Image

![TDX Guest Image Tool](../build/centos-stream-8/guest-image) create guest image with EFI partition and install TDX guest stack packages.

## Requirements
- Install virt-install and libguestfs-tools-c packages.
- TDX repo generated by build-repo.sh
- Checking libvirtd service and the default virbr0 interface are OK
  - `systemctl status libvirtd`
  - `ifconfig virbr0`

## Install Guest image with ISO installer
Generate td-guest-c8s.qcow2 by `./create-efi-img.sh`
- The script will download CentOS-Stream-8-x86_64-latest-dvd1.iso (~10G) if not exist.
- Then run virt-install to install guest image using kickstart scripts.

## Setup TDX guest stack in the guest image
Install tdx-guest-grub2, tdx-guest-shim and tdx-guest-kernel by `./tdx-guest-stack.sh`
- It will copy TDX guest repo to td-guest-c8s.qcow2 and install the guest packages
- Use the existing host environment in the guest. Such as /etc/environment, /etc/chrony.conf